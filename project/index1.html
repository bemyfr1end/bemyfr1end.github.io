

<!DOCTYPE html>
<html lang="en" >

<head>

  <meta charset="UTF-8">
  
<link rel="apple-touch-icon" type="image/png" href="https://static.codepen.io/assets/favicon/apple-touch-icon-5ae1a0698dcc2402e9712f7d01ed509a57814f994c660df9f7a952f3060705ee.png" />
<meta name="apple-mobile-web-app-title" content="CodePen">

<link rel="shortcut icon" type="image/x-icon" href="https://static.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico" />

<link rel="mask-icon" type="" href="https://static.codepen.io/assets/favicon/logo-pin-8f3771b1072e3c38bd662872f6b673a722f4b3ca2421637d5596661b4e2132cc.svg" color="#111" />


  <title>CodePen - Doesn&#39;t work in Safari but used to</title>
  
  
  
  
<style>
canvas { border: 1px solid black; display: block; }
#log {
    height: 20em;
    overflow: auto;
}

        .watson{
		border: 1px solid #B0BEC5;
		border-radius: 3px;
		height: 50em;
		max-height: 500px;
		padding: 1em;
		
		max-width: 500px;
		margin: 0 auto;
		
		display: flex;
		flex-direction: column;
		justify-content: space-between;
	}
	
	.watson .mensagens{
		box-sizing: border-box;
		overflow: hidden;
		overflow-y: auto;
		height: 100%;
	}
	
	.watson .mensagens .area{
		display: flex;
		justify-content: flex-end;
		flex-direction: column;
		min-height: 100%;
	}
	
	.watson .mensagens .texto{
		border-radius: 2px;
		box-sizing: border-box;
		padding: .65em;
		margin-top: .5em;
		
		animation: popupmensagem linear .2s;
		animation-iteration-count: 1;
		-webkit-animation: popupmensagem linear .2s;
		-webkit-animation-iteration-count: 1;
		-moz-animation: popupmensagem linear .2s;
		-moz-animation-iteration-count: 1;
		-o-animation: popupmensagem linear .2s;
		-o-animation-iteration-count: 1;
		-ms-animation: popupmensagem linear .2s;
		-ms-animation-iteration-count: 1;
	}
	
	.watson .mensagens .texto:first-child{
		margin-top: 0;
	}
	
	.watson .mensagens .texto.usuario{
		background-color: #fff;
		color: #000;
		margin-right: 30%;
		border: 1px solid #eee;
		
		transform-origin: 0% 100%;
		-webkit-transform-origin: 0% 100%;
		-moz-transform-origin: 0% 100%;
		-o-transform-origin: 0% 100%;
		-ms-transform-origin: 0% 100%;
	}
	
	.watson .mensagens .texto.chatbot{
		background-color: #000;
		color: white;
		font-weight: bold;
		margin-left: 30%;
		
		transform-origin: 100% 100%;
		-webkit-transform-origin: 100% 100%;
		-moz-transform-origin: 100% 100%;
		-o-transform-origin: 100% 100%;
		-ms-transform-origin: 100% 100%;
	}
	
	.watson form.mensagem{
		padding: 0;
		margin-top: 1em;
	}
	
	.watson form.mensagem input{
		border: 2px solid #476A7B;
		border-radius: 3px;
		padding: .5em .8em;
		font-size: 16px;
		display: block;
		box-sizing: border-box;
		width: 100%;
	}
	
	.watson form.mensagem input:focus{
		border: 2px solid #1A237E;
		outline: none;
	}
	
	.watson form.mensagem button{
		background-color: #000;
		border: none;
		border-radius: 3px;
		display: block;
		padding: .5em 1em;
		width: 100%;
		font-size: 16px;
		color: white;
		margin-top: .5em;
	}
	
	
	/**Animação de Mensagem**/
	
	@keyframes popupmensagem{
	  0% {
		transform:  scaleX(0.30) scaleY(0.30) ;
	  }
	  100% {
		transform:  scaleX(1.00) scaleY(1.00) ;
	  }
	}

	@-moz-keyframes popupmensagem{
	  0% {
		-moz-transform:  scaleX(0.30) scaleY(0.30) ;
	  }
	  100% {
		-moz-transform:  scaleX(1.00) scaleY(1.00) ;
	  }
	}

	@-webkit-keyframes popupmensagem {
	  0% {
		-webkit-transform:  scaleX(0.30) scaleY(0.30) ;
	  }
	  100% {
		-webkit-transform:  scaleX(1.00) scaleY(1.00) ;
	  }
	}

	@-o-keyframes popupmensagem {
	  0% {
		-o-transform:  scaleX(0.30) scaleY(0.30) ;
	  }
	  100% {
		-o-transform:  scaleX(1.00) scaleY(1.00) ;
	  }
	}

	@-ms-keyframes popupmensagem {
	  0% {
		-ms-transform:  scaleX(0.30) scaleY(0.30) ;
	  }
	  100% {
		-ms-transform:  scaleX(1.00) scaleY(1.00) ;
	  }
	}

	</style>
  <script>
  window.console = window.console || function(t) {};
</script>

  
  
  <script>
  if (document.location.search.match(/type=embed/gi)) {
    window.parent.postMessage("resize", "*");
  }
</script>


</head>

<body translate="no" >
 
<div id="watson" class="watson">
	 <div>
  <input id="stream" checked="" type="checkbox">: Use Streaming
</div>
<canvas></canvas>	
        <div class="mensagens">
            <div class="area" id="chat">
			
            </div>
			
        </div>
        <form id="mensagem" class="mensagem">
            <input type="text" id="texto" name="texto" placeholder="Place Type Your Message Here" />
            <button type="submit">Enter</button>
        </form>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script type="text/javascript">
            $("#mensagem").submit(function () {
				
				
                if ($("#mensagem #texto").val() === "") {
                    $("#chat").append("<div class=\"texto usuario\">...</div>");
                    $(".mensagens").animate({ scrollTop: $("#chat").height() });
                    setTimeout(function () {
                        //Adiciona uma resposta padrão afirmando que o usuário deixou o campo vazio
                        $("#chat").append("<div class=\"texto chatbot\">Unfortunely I didn't get that. Please try again</div>");
                        $(".mensagens").animate({ scrollTop: $("#chat").height() });
                    }, 1000);
                    return false;
                }

                var gambi2 = document.getElementById("texto").value;
				//var gambi3 = document.getElementById("dude").value;
                var gambi = JSON.stringify({
                    "input": {
                        "text": gambi2
                    }
                });
				/*var gambi5 = JSON.stringify({
                    "input": {
                        "text": gambi3
                    }
                });
				console.log(gambi5);
				*/
                console.log(gambi);
				//Inicia método AJAX
                $.ajax({
                    type: 'POST',
                    url: "https://bemyfr1end.herokuapp.com/index4.php?" +document.cookie,
                    dataType: 'json', // Determina o tipo de retorno
                    contentType: 'application/json',
                    data: gambi,
                    beforeSend: function (xhr) {
                      //  xhr.setRequestHeader("Authorization", "Basic " + btoa("00647b1b-ca45-4fd4-9c32-9e5c822f2703" + ":" + "eKWVoPisvLkb"));
                        $("#chat").append("<div class=\"texto usuario\">" + $("#mensagem #texto").val() + "</div>");
                    },
                    success: function (resposta) {
					//	var e = document.getElementById("mensagem");
					//e.id = "ape";
					//var f = document.getElementById("texto");
					//xhr1.open('POST', encodeURI('https://bemyfr1end.herokuapp.com/test.wav'), true);
					//f.id = "dude";
					try {
    if (!'MediaSource' in window)
        throw new ReferenceError('There is no MediaSource property in window object.');

    var mime = 'audio/mpeg';

    if (!MediaSource.isTypeSupported(mime)) {
        alert('Can not play the media. Media of MIME type ' + mime + ' is not supported.');
        throw ('Media of type ' + mime + ' is not supported.');
    }

    var audio = document.querySelector('audio'),
        mediaSource = new MediaSource();
    	
    audio.src = URL.createObjectURL(mediaSource);

    mediaSource.addEventListener('sourceopen', function() {
        var sourceBuffer = this.addSourceBuffer(mime);
        sourceBuffer.appendWindowEnd = 4.0;
        var xhr = new XMLHttpRequest;
        xhr.open('GET', 'https://raw.githubusercontent.com/rpsthecoder/mediasourceapi/master/sample.mp3');
        // xhr.open('GET', 'sample.mp3'); /* while testing in localhost */
        xhr.responseType = 'arraybuffer';
        xhr.onload = function() {
            try {
                switch (this.status) {
                    case 200:
                        sourceBuffer.appendBuffer(this.response);
                        sourceBuffer.addEventListener('updateend', function (_) {
                            mediaSource.endOfStream();
                        });
                        break;
                    case 404:
                        throw 'File Not Found';
                    default:
                        throw 'Failed to fetch the file';
                }
            } catch (e) {
                console.error(e);
            }
        };
        xhr.send();
    });
} catch (e) {
    console.error(e);
}
                        $("#mensagem #texto").val("");
                        $("#mensagem #texto").focus();

                        if (resposta.error) {
                            $("#chat").append("<div class=\"texto chatbot\">" + resposta.error + "</div>");
                            return false;
                        }
						window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;
						//var x5 = Cookies.get('audio');
						var audio = new Audio('https://bemyfr1end.herokuapp.com/test.wav');  
						audio.type = 'audio/wav';
						audio.crossOrigin = "anonymous";
						audio.src = "https://bemyfr1end.herokuapp.com/test.wav";
						audio.load();
						audio.play();
						var cookie1 = "session_id="+ resposta.session_id;
						//var cookie2 = "JSESSIONID=" + resp.sessionid;
						document.cookie = cookie1;
						//document.cookie = cookie2;
						var xy = document.cookie;
                        var mensagemChatbot = "<div class=\"texto chatbot\">";
                        mensagemChatbot += xy;
						mensagemChatbot += " ";
						mensagemChatbot += resposta.message;
                        mensagemChatbot += "</div>";
                        setTimeout(function () {
                            $("#chat").append(mensagemChatbot);
                            $(".mensagens").animate({ scrollTop: $("#chat").height() });
                        }, 1000);
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });

                return false;
            });
        </script>
    </div>

<div id="log">
  <pre>  </pre>
</div>


  
  
      <script id="rendered-js" >
"use strict";
const logElem = document.querySelector('#log>pre');
const ctx = document.querySelector("canvas").getContext("2d");

function log(...args) {
  logElem.textContent += [...args].join(' ') + '\n';
}

ctx.fillText("click to start", 100, 75);
ctx.canvas.addEventListener('click', start);

// Make a audio node
const audio = new Audio();
audio.loop = false;
audio.autoplay = true;
// have something ready to play when the user clicks to start
audio.src = "data:audio/mp3;base64,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LpkVrc5yk0NnT5DN0r7ygGqp9SJxOeOSSTeJQgIRIKh6SBKLhsdFgnl4lic2AkshcfBYDR2PUjSDGiSttUZNSSMKkiMpyPz9XLaihbS6uJe0Qo39FI9RhJiijnMQAmqRJQnTnQQ9B6DATEFNRTMuOTkuNVW3U5Tx7Sg0GtNZay5wXQa29Bbl+W7LSqP/EUHXUMbiZZqWyph7iXH/eWVVovK8YFykUhfWpzKggb6B/o1f2ki9UxI8hDlinajtn1JsJGxmb0bOkuali0UaruYXWWcevHypyrfULvoUbdYW1ydMBPE6OqOplGZJbTRCQtDcrmVtVrK9TrpTM7lZijZ1rPtbwvvWbf69tPpZMVhe9GHEVuZt4rBdK5yT0a/ezMy4QrD60qtiTyZVsdUwnKE+b1TCOZnVrDRQnUywLHUnUVDV0sWVEFchCWZkNLiolpOD+bYTKfy5fmMlVyxZXCFrKmSTa5pRXM7w/+NoZPQfVjcEAGDPdiUsbg2ACN9MfSvcUWpFbTdensr6+XlZL8y/Po5TLn5WbBy75F8nmbTfY0s28yyHVD+sf9k12LpWSz6W5s3///z/+5XKktIqQbR9KBeCeS3IOBW1H8SjNCYt51CfMa4bXF+imtxZoDCxQn7gnVUpGN8+V2FLZxhxU7IrtJ0/pEusMbyRmzFckojzujKFkMshh9zKVEIefKGKtkQ47UVATb1NpRvVTEFNRTMuOTkuNVVVVVK4p5fWFEpWRCj+V5wkqN8pRbjZPAuJhHGS03lpEl5C+EiHGOknSnVMiqP1jOldLSGti0rTFErRp4SImoJTlbLYceic8+m2fv//q0Tj0SRezFPLbNGmJEStzv/5bZb/7LbLZTy2vlHFmJhICAxgUUkblWicXs5T5Wy+blS2y8tst/L/0WgkRAoSnKdtySvWwRrYL/MzNt5cdNuLmYmru702hWFoSR6KiC7/PHLEdTIeTAfhBKgfAiJ5ofbXWCcAkHREFxJcMjsfQmMAqHksE7TlQDYFhDCEGwVLOk1L5rDv50mqzbu1Jtsoa7Q7tlOaw7+d/+NoZPIbBjbsADzMbi1cbdSgGZ+gJsoa655Q1pH/DUGjUm1n5rDWEGdWNSaHeGqMxrDWGv/3ampNShrVh0mNasNZT5OU6J1zhpSwCYOBUAopIjCTonXvetz9xZoNJreumJdo0gxhIWZJ/O0NYEcfrmaKcMonqGGUfqwhq8tIavObpmTqJUiXMk/l2yO4uXrcznST43yaiTG4MYbp+IJWzK5rhxLvVMrzhL8izyJSbhelTEFNRTMuOTkuNVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";

function waitSeconds(secs) {
  return new Promise(resolve => {
    setTimeout(resolve, secs * 1000);
  });
}

function start() {
  ctx.canvas.removeEventListener('click', start);
  ctx.canvas.addEventListener('click', pause);

  const useStream = document.querySelector('#stream').checked;
  const url = useStream ?
  'https://c2.radioboss.fm:18071/stream' :
  'https://bemyfr1end.herokuapp.com/hello_world.mp3';
  let connected = false;

  // make a Web Audio Context
  const context = new (window.AudioContext || window.webkitAudioContext)();
  const analyser = context.createAnalyser();
  const gainNode = context.createGain();
  analyser.connect(gainNode);
  gainNode.connect(context.destination);

  // Make a buffer to receive the audio data
  const numPoints = analyser.frequencyBinCount;
  const audioDataArray = new Uint8Array(numPoints);

  function render() {
    ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);

    // get the current audio data
    analyser.getByteFrequencyData(audioDataArray);

    const width = ctx.canvas.width;
    const height = ctx.canvas.height;
    const size = 5;

    // draw a point every size pixels
    for (let x = 0; x < width; x += size) {
      // compute the audio data for this point
      const ndx = x * numPoints / width | 0;
      // get the audio data and make it go from 0 to 1
      const audioValue = audioDataArray[ndx] / 255;
      // draw a rect size by size big
      const y = audioValue * height;
      ctx.fillRect(x, y, size, size);
    }

    ctx.fillText('click to pause/play', 20, 20);

    requestAnimationFrame(render);
  }
  requestAnimationFrame(render);


  audio.play();

  setTimeout(() => {
    log('set audio.src:', url);
    audio.crossOrigin = "anonymous";
    audio.src = url;
    audio.load();
  }, 250);

  // call `handleCanplay` when it music can be played
  audio.addEventListener('canplay', handleCanplay);

  function handleCanplay() {
    // connect the audio element to the analyser node and the analyser node
    // to the main Web Audio context
    if (!connected) {
      log('connect media');
      connected = true;
      const source = context.createMediaElementSource(audio);
      source.connect(analyser);
    }
  }

  function pause() {
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  }
}
    </script>

  

</body>

</html>
 
